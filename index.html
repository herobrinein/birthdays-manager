<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥ç®¡å®¶</title>
	<title>ç”Ÿæ—¥ç®¡å®¶</title>
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- iOS æ”¯æŒ (è®©å®ƒåœ¨ iPhone ä¸Šçœ‹èµ·æ¥åƒ App) -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#e74c3c">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script>
        // åœ¨é¡µé¢åŠ è½½å‰æ£€æŸ¥ç”¨æˆ·ä¸»é¢˜åå¥½
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <style>
        :root {
            /* é¢œè‰²å˜é‡ - é»˜è®¤æµ…è‰² */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-sub: #7f8c8d;
            --primary: #e74c3c;
            --primary-light: #ffebe9;
            --accent: #3498db;
            --accent-light: #ebf5fb;
            --success: #2ecc71;
            --border: #e0e0e0;
            --today-bg: #fff5f5;
            --shadow: rgba(0, 0, 0, 0.08);
            --sidebar-width: 320px;
            --radius: 12px;
            --transition: all 0.3s ease;
            --celebration: #ff6b6b;
            --celebration-light: #fff0f0;
        }

        [data-theme="dark"] {
            --bg-color: #121826;
            --card-bg: #1e293b;
            --text-main: #e2e8f0;
            --text-sub: #94a3b8;
            --primary: #ef4444;
            --primary-light: #3d2b2b;
            --accent: #3b82f6;
            --accent-light: #1e293b;
            --success: #10b981;
            --border: #334155;
            --today-bg: #3d2b2b;
            --shadow: rgba(0, 0, 0, 0.2);
            --celebration: #ff8a8a;
            --celebration-light: #3d2b2b;
        }
		
		#title-icon {
            color: var(--primary);
        }

        * {
            box-sizing: border-box;
        }
		
		/* ä¸ºä»¥ä¸‹å…ƒç´ æ·»åŠ è¿‡æ¸¡åŠ¨ç”» */
        .theme-toggle i,
        .user-item,
        .birthday-tag,
        .festival,
        .age-num,
        .avatar,
        .celebration-avatar,
        .upcoming-card,
        .celebration-card,
        .day-cell .solar-num,
        .day-cell .lunar-info,
        .calendar-type,
        .celebration-title i,
        .celebration-card::before {
            transition: var(--transition);
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æ—¶æŒ‰é’®é¢œè‰²çš„å¹³æ»‘è¿‡æ¸¡ */
        .calendar-header button,
        .today-btn {
            transition: var(--transition);
        }
        
        /* ç¡®ä¿æ‰€æœ‰æ–‡æœ¬é¢œè‰²å˜åŒ–ä¹Ÿæœ‰è¿‡æ¸¡ */
        h2, h3, h4, p, .user-name, .user-details, 
        .celebration-name, .celebration-date,
        .upcoming-name, .upcoming-date {
            transition: color 0.3s ease;
        }
        
        /* å›¾ç‰‡è¾¹æ¡†é¢œè‰²çš„è¿‡æ¸¡ */
        .avatar, .celebration-avatar {
            transition: border-color 0.3s ease, transform 0.3s ease;
        }
        
        /* ç¡®ä¿æŒ‰é’®æ‚¬åœæ•ˆæœå¹³æ»‘ */
        .calendar-header button:hover,
        .today-btn:hover {
            transition: var(--transition);
        }
        
        /* ä¸ºä¾§è¾¹æ é¢æ¿æ·»åŠ è¿‡æ¸¡ */
        .friends-panel,
        .upcoming-panel {
            transition: var(--transition);
        }
        
        /* ä¸ºåº†ç¥æ¨ªå¹…æ·»åŠ è¿‡æ¸¡ */
        .celebration-banner {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        /* å…¨å±åº†ç¥å¼¹çª—çš„æ˜¾ç¤º/éšè—è¿‡æ¸¡ */
        .fullscreen-celebration {
            transition: opacity 0.5s ease;
        }

        body {
            font-family: 'Segoe UI', "Microsoft YaHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            transition: var(--transition);
        }

        .container {
            display: grid;
            grid-template-columns: 1fr var(--sidebar-width);
            gap: 24px;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 24px;
        }

        /* æ—¥å†æ ·å¼ */
        .calendar-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: 0 6px 20px var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            position: relative;
        }

        /* åº†ç¥æ¨ªå¹…æ ·å¼ */
        .celebration-banner {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--celebration), #ff8a8a);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .calendar-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .calendar-header button {
            background: var(--accent-light);
            border: none;
            color: var(--accent);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-header button:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.05);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: auto repeat(6, 1fr); /* å›ºå®š6è¡Œ */
            gap: 8px;
            height: 700px; /* å›ºå®šæœ€å°é«˜åº¦ */
        }
		
		/* æ—¥å†å¯¼èˆªæŒ‰é’®å®¹å™¨ */
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* å›åˆ°ä»Šå¤©æŒ‰é’® */
        .today-btn {
            background: var(--primary-light);
            border: none;
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            font-weight: 500;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
        
        .today-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .day-name {
            text-align: center;
            font-weight: 600;
            padding: 12px 0;
            color: var(--text-sub);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .day-cell {
            min-height: 100px;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            transition: var(--transition);
            background: var(--card-bg);
            /* æ·»åŠ å¼¹æ€§åŸºç¡€é«˜åº¦ */
            flex: 1 0 auto;
        }

        .day-cell:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .day-cell.today {
            background-color: var(--today-bg);
            border: 2px solid var(--primary);
            position: relative;
        }

        .day-cell.today::before {
            content: "ä»Šå¤©";
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--primary);
            color: white;
            font-size: 0.6rem;
            padding: 1px 6px;
            border-radius: 10px;
        }
        
        /* ä»Šå¤©æœ‰äººè¿‡ç”Ÿæ—¥çš„æ ·å¼ */
        .day-cell.today-birthday {
            animation: birthdayGlow 2s infinite alternate;
            border: 2px solid var(--celebration);
            background-color: var(--celebration-light);
        }
        
        @keyframes birthdayGlow {
            from { box-shadow: 0 0 10px rgba(255, 107, 107, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 107, 107, 0.8); }
        }

        .solar-num {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 2px;
        }

        .lunar-info {
            font-size: 0.75rem;
            color: var(--text-sub);
            margin-bottom: 4px;
            min-height: 16px;
        }

        .festival {
            color: var(--primary);
            font-weight: 500;
        }

        .birthday-tag {
            background: linear-gradient(135deg, var(--primary), #ff8a8a);
            color: white;
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 6px;
            margin-top: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.2);
        }

        .birthday-tag i {
            font-size: 0.7rem;
        }

        /* ä¾§è¾¹æ ä¸åˆ—è¡¨ */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }
		
        .friends-panel {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 6px 20px var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            height: 834px; /* ä¿æŒåŸæœ‰é«˜åº¦ */
            display: flex;
            flex-direction: column;
            /* æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œä»¥å®ç°æ»šåŠ¨ */
            overflow: hidden; /* é˜²æ­¢é¢æ¿æœ¬èº«æº¢å‡º */
            position: relative; /* ä¸ºç»å¯¹å®šä½çš„æ»šåŠ¨åŒºåŸŸæä¾›å‚è€ƒ */
        }
        
        /* æ·»åŠ å¥½å‹åˆ—è¡¨æ»šåŠ¨å®¹å™¨æ ·å¼ */
        .friends-list-container {
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
            overflow-y: auto; /* å‚ç›´æ»šåŠ¨ */
            overflow-x: hidden; /* éšè—æ¨ªå‘æ»šåŠ¨æ¡ */
            margin-top: 16px; /* ä¸æ ‡é¢˜ä¿æŒè·ç¦» */
            padding-right: 4px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºç©ºé—´ */
            /* ç¡®ä¿å†…å®¹ä¸ä¼šè¶…å‡ºå®¹å™¨ */
            max-width: 100%;
        }
		
		/* ç¡®ä¿æ»šåŠ¨å®¹å™¨å†…å®¹ä¸ä¼šæº¢å‡º */
        #friendsList {
            display: flex;
            flex-direction: column;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* ç§»é™¤ä¹‹å‰å¯èƒ½æ·»åŠ çš„é¢å¤–æ ·å¼ */
        .user-item:last-child {
            border-bottom: 1px solid var(--border); /* ç¡®ä¿æœ€åä¸€é¡¹ä¹Ÿæœ‰è¾¹æ¡† */
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .friends-list-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .friends-list-container::-webkit-scrollbar-track {
            background: var(--bg-color);
            border-radius: 3px;
        }
        
        .friends-list-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
        
        .friends-list-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-sub);
        }
		
		/* ä¸ºæœªæ¥30å¤©åˆ›å»ºæ–°æ ·å¼ */
        .upcoming-panel {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 6px 20px var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            /* ä¸è®¾ç½®å›ºå®šé«˜åº¦ï¼Œè®©å†…å®¹è‡ªé€‚åº” */
            display: flex;
            flex-direction: column;
            margin-top: 20px;
            width: 100%;
            max-width: 1200px;
        }
		
		/* å…¨å±åº†ç¥åŠ¨ç”»å®¹å™¨ */
        .fullscreen-celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* å…³é—­æŒ‰é’® */
        .celebration-close {
            position: absolute;
            top: 100px;
            right: 100px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            z-index: 10001;
            transition: all 0.3s ease;
        }
        
        .celebration-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        /* å½©æ¡åŠ¨ç”»å…ƒç´  */
        .confetti {
            position: absolute;
            width: 10px;
            height: 20px;
            background: #ff6b6b;
            top: -20px;
        }
        
        .confetti:nth-child(2n) {
            background: #4ecdc4;
        }
        .confetti:nth-child(3n) {
            background: #ffe66d;
        }
        .confetti:nth-child(4n) {
            background: #9b5de5;
        }
        .confetti:nth-child(5n) {
            background: #00bbf9;
        }
        
        /* åº†ç¥æ¶ˆæ¯æ¡† */
        .celebration-message {
            background: linear-gradient(135deg, #ff6b6b, #ff8a8a);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            z-index: 10000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: pulseMessage 2s infinite alternate;
        }
        
        @keyframes pulseMessage {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        
        .celebration-message h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .celebration-message h2 i {
            animation: bounce 1s infinite alternate;
        }
        
        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }
        
        .celebration-names {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 20px 0;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .celebration-countdown {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 20px;
        }
        
        /* åº†ç¥é¢æ¿æ ·å¼ */
        .celebration-panel {
            background: linear-gradient(135deg, var(--celebration-light), var(--card-bg));
            border: 2px solid var(--celebration);
            animation: panelPulse 3s infinite alternate;
        }
        
        @keyframes panelPulse {
            from { box-shadow: 0 0 15px rgba(255, 107, 107, 0.3); }
            to { box-shadow: 0 0 25px rgba(255, 107, 107, 0.6); }
        }
        
        .celebration-title {
            color: var(--celebration);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }
        
        .celebration-title i {
            animation: spin 4s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .celebration-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .celebration-card {
            background: linear-gradient(135deg, var(--card-bg), var(--celebration-light));
            border-radius: 12px;
            padding: 20px;
            border-left: 6px solid var(--celebration);
            transition: var(--transition);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .celebration-card::before {
            content: "ğŸ‰";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .celebration-card::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--celebration), transparent);
        }
        
        .celebration-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--celebration);
            margin-bottom: 12px;
            padding: 2px;
            background-color: white;
        }
        
        .celebration-name {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--text-main);
        }
        
        .celebration-age {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--celebration);
            margin: 8px 0;
        }
        
        .celebration-date {
            font-size: 0.9rem;
            color: var(--text-sub);
            margin-top: 5px;
        }

        .info-panel h3 {
            margin-top: 0;
            margin-bottom: 16px;
            color: var(--text-main);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-panel h3 i {
            color: var(--accent);
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
            box-sizing: border-box;
            max-width: 100%;
        }

        .user-item:hover {
            background: var(--bg-color);
            position: relative;
            z-index: 1;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            background: linear-gradient(135deg, var(--accent-light), var(--accent));
            padding: 2px;
            border: 2px solid var(--accent);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-details {
            font-size: 0.85rem;
            color: var(--text-sub);
            line-height: 1.4;
        }

        .age-num {
            font-family: 'Courier New', monospace;
            color: var(--success);
            font-weight: bold;
            font-size: 1rem;
        }

        .calendar-type {
            display: inline-block;
            background: var(--bg-color);
            color: var(--text-sub);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 6px;
        }

        .calendar-type.lunar {
            background: #f0f7ff;
            color: #3498db;
        }
		
		[data-theme="dark"] .calendar-type.lunar {
            background: #1e293b;
            color: #93c5fd;
        }

        .upcoming-list {
            width: 100%;
            max-width: 1200px;
        }

        .upcoming-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .upcoming-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 16px;
            border-left: 4px solid var(--accent);
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .upcoming-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px var(--shadow);
        }

        .upcoming-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        .upcoming-days {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
        }

        .upcoming-date {
            font-size: 0.85rem;
            color: var(--text-sub);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-sub);
        }

        .empty-state i {
            font-size: 2.5rem;
            color: var(--border);
            margin-bottom: 16px;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 1.5rem;
            background: var(--card-bg);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px var(--shadow);
            transition: var(--transition);
            z-index: 100;
            border: 1px solid var(--border);
        }

        .theme-toggle:hover {
            transform: rotate(15deg);
        }
		
		/* æ·»åŠ å›åˆ°ä»Šå¤©æŒ‰é’®æ ·å¼ */
        .today-btn {
            background: var(--primary-light);
            border: none;
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .today-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }
        
        /* è°ƒæ•´æ—¥å†å¤´éƒ¨å¸ƒå±€ */
        .calendar-header > div {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 992px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
        }

        /* ç§»åŠ¨ç«¯ä¸“å±ä¼˜åŒ–æ ·å¼ */
        @media (max-width: 576px) {
            body {
                padding: 12px;
            }
            
            h2 {
                font-size: 1.3rem;
                margin-top: 0;
                padding-top: 10px;
            }
            
            .container {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .calendar-card {
                padding: 16px;
                margin-top: 20px;
            }
            
            .calendar-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
                margin-bottom: 16px;
            }
            
            .calendar-header button {
                width: 44px; /* å¢åŠ å®½åº¦ */
                height: 44px; /* å¢åŠ é«˜åº¦ */
                min-width: 44px; /* é˜²æ­¢è¢«å‹ç¼© */
                font-size: 1rem;
            }
            
            /* è°ƒæ•´"ä»Šå¤©"æŒ‰é’®æ ·å¼ */
            .today-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
                white-space: nowrap;
                min-width: 70px; /* è®¾ç½®æœ€å°å®½åº¦ */
                height: 44px; /* ä¸å·¦å³ç®­å¤´æŒ‰é’®é«˜åº¦ä¸€è‡´ */
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* ç¡®ä¿æ—¥å†æ ‡é¢˜åŒºåŸŸæœ‰è¶³å¤Ÿç©ºé—´ */
            .calendar-header {
                gap: 12px;
                padding-bottom: 12px;
            }
            
            .calendar-header h2 {
                font-size: 1.3rem;
                order: 1;
                width: 100%;
                text-align: center;
            }
            
            .calendar-grid {
                grid-template-rows: auto repeat(6, 1fr);
                height: auto;
                min-height: 450px;
                gap: 4px;
            }
            
            .day-cell {
                min-height: 65px;
                padding: 4px;
                border-radius: 6px;
            }
            
            .solar-num {
                font-size: 0.9rem;
                margin-bottom: 1px;
            }
            
            .lunar-info {
                font-size: 0.65rem;
                margin-bottom: 2px;
            }
            
            .birthday-tag {
                font-size: 0.65rem;
                padding: 3px 6px;
                margin-top: 2px;
            }
            
            .friends-panel {
                padding: 16px;
                height: 500px; /* ç§»åŠ¨ç«¯å‡å°é«˜åº¦ */
            }
            
            .friends-list-container {
                margin-top: 12px;
            }
            
            .user-item {
                padding: 10px;
                gap: 10px;
            }
            
            .avatar {
                width: 42px;
                height: 42px;
                min-width: 42px; /* é˜²æ­¢å›¾ç‰‡è¢«å‹ç¼© */
            }
            
            .user-name {
                font-size: 0.95rem;
            }
            
            .user-details {
                font-size: 0.8rem;
            }
            
            .age-num {
                font-size: 0.9rem;
            }
            
            /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®è°ƒæ•´ */
            .theme-toggle {
                top: 15px;
                right: 15px;
                width: 42px;
                height: 42px;
                font-size: 1.2rem;
            }
            
            /* åŠ¨æ€é¢æ¿è°ƒæ•´ */
            .upcoming-panel {
                padding: 16px;
                margin-top: 16px;
            }
            
            .upcoming-cards,
            .celebration-cards {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }
            
            .upcoming-card,
            .celebration-card {
                padding: 14px;
            }
            
            .celebration-avatar {
                width: 60px;
                height: 60px;
            }
            
            .celebration-name {
                font-size: 1rem;
            }
            
            .celebration-age {
                font-size: 1.3rem;
            }
            
            /* åº†ç¥æ¨ªå¹…è°ƒæ•´ */
            .celebration-banner {
                font-size: 0.75rem;
                padding: 6px 12px;
                top: -12px;
                white-space: nowrap;
                max-width: 90%;
            }
            
            /* å…¨å±åº†ç¥å¼¹çª—ä¼˜åŒ– */
            .fullscreen-celebration {
                padding: 20px;
            }
            
            .celebration-close {
                top: 20px;
                right: 20px;
                width: 44px;  /* ç¡®ä¿å®½é«˜ç›¸ç­‰ */
                height: 44px; /* ç¡®ä¿å®½é«˜ç›¸ç­‰ */
                font-size: 1.2rem;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50% !important; /* å¼ºåˆ¶åœ†å½¢ */
                aspect-ratio: 1; /* ä¿æŒå®½é«˜æ¯” */
            }
            
            .celebration-message {
                padding: 30px 20px;
                margin: 0 15px;
            }
            
            .celebration-message h2 {
                font-size: 1.8rem;
                flex-direction: row; /* ç¡®ä¿æ°´å¹³æ’åˆ— */
                flex-wrap: nowrap; /* é˜²æ­¢æ¢è¡Œ */
                gap: 10px;
                white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
            }
            
            .celebration-names {
                font-size: 1.4rem;
                margin: 15px 0;
            }
            
            /* æ”¹è¿›è§¦æ‘¸ç›®æ ‡å¤§å° */
            button, 
            .calendar-header button,
            .today-btn,
            .user-item {
                min-height: 44px; /* iOSæ¨èæœ€å°è§¦æ‘¸ç›®æ ‡ */
            }
            
            .calendar-header button {
                width: 36px;
                height: 36px;
            }
            
            .today-btn {
                padding: 10px 18px;
                font-size: 0.85rem;
            }
            
            /* ç¡®ä¿æ–‡æœ¬ä¸ä¼šæº¢å‡º */
            .user-name,
            .celebration-name,
            .upcoming-name {
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            /* ä¼˜åŒ–æ»šåŠ¨ä½“éªŒ */
            .friends-list-container {
                -webkit-overflow-scrolling: touch; /* iOSå¹³æ»‘æ»šåŠ¨ */
            }
        }
        
        /* è¶…å°å±å¹•è®¾å¤‡ï¼ˆå¦‚iPhone SEç­‰ï¼‰ */
        @media (max-width: 375px) {
		    .calendar-nav {
                gap: 6px; /* åœ¨æ›´å°çš„å±å¹•ä¸Šå‡å°é—´è· */
            }
            
            .calendar-header button {
                width: 40px;
                height: 40px;
            }
            
            .today-btn {
                min-width: 65px;
                padding: 8px 12px;
                font-size: 0.85rem;
                height: 40px; /* ä¸å·¦å³ç®­å¤´æŒ‰é’®é«˜åº¦ä¸€è‡´ */
            }
			
            .calendar-grid {
                min-height: 400px;
            }
            
            .day-cell {
                min-height: 55px;
            }
            
            .solar-num {
                font-size: 0.85rem;
            }
            
            .lunar-info {
                font-size: 0.6rem;
            }
            
            .birthday-tag {
                font-size: 0.6rem;
                padding: 2px 4px;
            }
            
            .upcoming-cards,
            .celebration-cards {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .friends-panel {
                height: 450px;
            }
            
            h2 {
                font-size: 1.2rem;
                padding-left: 10px;
                padding-right: 10px;
                text-align: center;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
        }
        
        /* å¹³æ¿è®¾å¤‡æ¨ªå‘ä¼˜åŒ– */
        @media (min-width: 768px) and (max-width: 992px) and (orientation: landscape) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
            
            .calendar-grid {
                height: 600px;
            }
            
            .friends-panel {
                height: 800px;
            }
        }
        
        /* å¹³æ¿è®¾å¤‡çºµå‘ä¼˜åŒ– */
        @media (min-width: 768px) and (max-width: 992px) and (orientation: portrait) {
            .calendar-grid {
                height: 600px;
            }
            
            .friends-panel {
                height: 550px;
            }
        }
        
        /* é’ˆå¯¹å…¨é¢å±æ‰‹æœºçš„åº•éƒ¨å®‰å…¨åŒºåŸŸ */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(12px, env(safe-area-inset-left));
                padding-right: max(12px, env(safe-area-inset-right));
                padding-top: max(12px, env(safe-area-inset-top));
                padding-bottom: max(12px, env(safe-area-inset-bottom));
            }
        }
        
        /* é˜²æ­¢ç§»åŠ¨ç«¯æ¨ªå±æ—¶å­—ä½“è¿‡å¤§ */
        @media (max-width: 992px) {
            html {
                -webkit-text-size-adjust: 100%; /* é˜²æ­¢iOSæ¨ªå±æ—¶å­—ä½“æ”¾å¤§ */
            }
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–ç‚¹å‡»æ•ˆæœ */
        @media (hover: none) and (pointer: coarse) {
            .calendar-header button:active,
            .today-btn:active,
            .user-item:active {
                opacity: 0.7;
                transform: scale(0.98);
            }
            
            /* ç§»é™¤ç§»åŠ¨ç«¯ä¸éœ€è¦çš„æ‚¬åœæ•ˆæœ */
            .day-cell:hover {
                transform: none;
                box-shadow: none;
            }
            
            .calendar-header button:hover,
            .today-btn:hover {
                transform: none;
            }
        }
        
        /* ç§»åŠ¨ç«¯æ—¥å†æ˜ŸæœŸæ ‡é¢˜ä¼˜åŒ– */
        @media (max-width: 768px) {
            .day-name {
                padding: 8px 0;
                font-size: 0.8rem;
            }
        }
        
        /* ç¡®ä¿ç§»åŠ¨ç«¯æ¨¡æ€æ¡†ä¸è¢«é”®ç›˜é®æŒ¡ */
        @media (max-width: 768px) {
            .fullscreen-celebration {
                align-items: flex-start;
                padding-top: 80px;
                overflow-y: auto;
            }
        }
        
        /* ç§»åŠ¨ç«¯å›¾ç‰‡åŠ è½½ä¼˜åŒ– */
        @media (max-width: 768px) {
            .avatar,
            .celebration-avatar {
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
            }
        }
        
        /* ç§»åŠ¨ç«¯æ»šåŠ¨æ¡éšè—ï¼ˆä½†ä»å¯æ»šåŠ¨ï¼‰ */
        @media (max-width: 768px) {
            .friends-list-container::-webkit-scrollbar {
                width: 4px;
            }
        }
        
        /* ç§»åŠ¨ç«¯åŠ¨ç”»æ€§èƒ½ä¼˜åŒ– */
        @media (max-width: 768px) {
            * {
                /* å‡å°‘ä¸å¿…è¦çš„åŠ¨ç”»ä»¥èŠ‚çœæ€§èƒ½ */
                animation-duration: 0.5s !important;
            }
            
            .celebration-banner {
                animation: none; /* ç§»åŠ¨ç«¯å¯èƒ½ä¸éœ€è¦è„‰å†²åŠ¨ç”» */
            }
        }
    </style>
</head>
<body>

<h2>
    <i id="title-icon" class="fas fa-cake-candles"></i> ç”Ÿæ—¥ç®¡å®¶
</h2>
<div class="theme-toggle" onclick="toggleTheme()">
    <i class="fas fa-moon"></i>
</div>

<!-- å…¨å±åº†ç¥åŠ¨ç”» -->
<div id="fullscreenCelebration" class="fullscreen-celebration">
    <button class="celebration-close" onclick="closeCelebration()">
        <i class="fas fa-times"></i>
    </button>
    
    <div class="celebration-message">
        <h2>
            <i class="fas fa-birthday-cake"></i>
            ç”Ÿæ—¥å¿«ä¹ï¼
            <i class="fas fa-birthday-cake"></i>
        </h2>
        <div id="celebrationNames" class="celebration-names">
            <!-- é€šè¿‡JSåŠ¨æ€å¡«å…… -->
        </div>
        <p>ä»Šå¤©æœ‰äººè¿‡ç”Ÿæ—¥ï¼Œè®©æˆ‘ä»¬ä¸€èµ·ç¥ç¦TAï¼</p>
        <p class="celebration-countdown" id="countdown">10ç§’åè‡ªåŠ¨å…³é—­</p>
    </div>
</div>

<div class="container">
    <div class="calendar-card">
        <!-- åº†ç¥æ¨ªå¹…ï¼ˆé»˜è®¤éšè—ï¼Œæœ‰ç”Ÿæ—¥æ—¶æ˜¾ç¤ºï¼‰ -->
        <div id="celebrationBanner" class="celebration-banner" style="display: none;">
            <i class="fas fa-birthday-cake"></i>
            <span id="bannerText">ä»Šå¤©æœ‰äººè¿‡ç”Ÿæ—¥ï¼</span>
        </div>
        
        <div class="calendar-header">
            <div class="calendar-nav">
                <button onclick="prevMonth()"><i class="fas fa-chevron-left"></i></button>
                <button onclick="goToToday()" class="today-btn">ä»Šå¤©</button>
                <button onclick="nextMonth()"><i class="fas fa-chevron-right"></i></button>
            </div>
            <h2 id="currentMonthDisplay">2023å¹´ 10æœˆ</h2>
        </div>
        <div class="calendar-grid" id="calendarGrid">
            <!-- æ—¥å†å°†é€šè¿‡JSç”Ÿæˆ -->
        </div>
    </div>

    <div class="sidebar">
        <div class="info-panel friends-panel">
            <h3><i class="fas fa-users"></i> å¥½å‹åˆ—è¡¨ </h3>
            <div class="friends-list-container">
                <div id="friendsList">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>
</div>

<!-- åŠ¨æ€å†…å®¹é¢æ¿ï¼šå¯èƒ½æ˜¯åº†ç¥é¢æ¿æˆ–æœªæ¥30å¤©é¢æ¿ -->
<div id="dynamicPanel" class="upcoming-panel">
    <!-- å†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
</div>

<script>
    const solarFestivals = {
        '1-1': 'å…ƒæ—¦',
        '2-14': 'æƒ…äººèŠ‚',
        '3-8': 'å¦‡å¥³èŠ‚',
        '3-12': 'æ¤æ ‘èŠ‚',
        '4-1': 'æ„šäººèŠ‚',
        '4-22': 'åœ°çƒæ—¥',
        '5-1': 'åŠ³åŠ¨èŠ‚',
        '5-4': 'é’å¹´èŠ‚',
        '5-12': 'æŠ¤å£«èŠ‚',
        '6-1': 'å„¿ç«¥èŠ‚',
        '6-5': 'ç¯å¢ƒæ—¥',
        '7-1': 'å»ºå…šèŠ‚',
        '8-1': 'å»ºå†›èŠ‚',
        '9-10': 'æ•™å¸ˆèŠ‚',
        '9-21': 'å’Œå¹³æ—¥',
        '10-1': 'å›½åº†èŠ‚',
        '10-31': 'ä¸‡åœ£èŠ‚',
        '11-11': 'å…‰æ£èŠ‚',
        '12-1': 'è‰¾æ»‹ç—…æ—¥',
        '12-24': 'å¹³å®‰å¤œ',
        '12-25': 'åœ£è¯èŠ‚'
    };

    // å…¨å±€å˜é‡
    let currentDate = new Date();
    let birthdayData = [];
    let todayBirthdays = []; // å­˜å‚¨ä»Šå¤©è¿‡ç”Ÿæ—¥çš„äºº

    // æå–é‡å¤çš„å†œå†ç”Ÿæ—¥è®¡ç®—é€»è¾‘
    function getLunarBirthdaySolarDate(birthDate, targetYear) {
        const lunarBirth = Lunar.fromDate(birthDate);
        const targetYearLunar = Lunar.fromYmd(
            targetYear, 
            lunarBirth.getMonth(), 
            lunarBirth.getDay()
        );
        return new Date(targetYearLunar.getSolar().toYmd());
    }

    //è®¡ç®—å¹´é¾„çš„å‡½æ•°ï¼ˆé€€ä½åˆ¶ï¼Œç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸¤ä½ï¼‰
    function calculateAge(birthDate, isLunar = false) {
        const now = new Date();
        const birth = new Date(birthDate);
        
		// ç»Ÿä¸€ä½¿ç”¨å…¬å†è®¡ç®—æ³•å®šå¹´é¾„
        // æ— è®ºç”¨æˆ·è¿‡å†œå†è¿˜æ˜¯å…¬å†ç”Ÿæ—¥ï¼Œæ³•å¾‹å¹´é¾„éƒ½æŒ‰å…¬å†è®¡ç®—
		
        // å…¬å†ç”Ÿæ—¥ç›´æ¥è®¡ç®—
        let age = now.getFullYear() - birth.getFullYear();
        const monthDiff = now.getMonth() - birth.getMonth();
        const dayDiff = now.getDate() - birth.getDate();
        
        // å¦‚æœä»Šå¹´ç”Ÿæ—¥è¿˜æ²¡è¿‡ï¼Œå¹´é¾„å‡1
        if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
            age--;
        }
        
        // è®¡ç®—ç²¾ç¡®åˆ°å¤©çš„å°æ•°éƒ¨åˆ†ï¼ˆé€€ä½åˆ¶ï¼‰
        const nextBirthday = new Date(now.getFullYear(), birth.getMonth(), birth.getDate());
        if (now > nextBirthday) {
            nextBirthday.setFullYear(nextBirthday.getFullYear() + 1);
        }
        const daysUntilNextBirthday = Math.ceil((nextBirthday - now) / (1000 * 60 * 60 * 24));
        const daysSinceLastBirthday = 365 - daysUntilNextBirthday;
        
        // ä½¿ç”¨Math.floorå‘ä¸‹å–æ•´ï¼Œé¿å…å››èˆäº”å…¥
        const fractionalYear = Math.floor((daysSinceLastBirthday / 365) * 100) / 100;
        
        return (age + fractionalYear).toFixed(2);
    }
	
	// æ ¼å¼åŒ–å†œå†æ—¥æœŸæ˜¾ç¤º
    function formatLunarDate(date) {
        try {
            const solar = Solar.fromDate(date);
            const lunar = solar.getLunar();
            return `${lunar.getYear()}å¹´${lunar.getMonthInChinese()}æœˆ${lunar.getDayInChinese()}`;
        } catch (e) {
            console.log("å†œå†æ ¼å¼åŒ–é”™è¯¯:", e);
            return "å†œå†æ—¥æœŸé”™è¯¯";
        }
    }
	
	// æ ¼å¼åŒ–å†œå†æ˜¾ç¤ºï¼ˆä»…æœˆæ—¥ï¼‰
    function formatLunarDisplay(date) {
        try {
            const solar = Solar.fromDate(date);
            const lunar = solar.getLunar();
            return `${lunar.getMonthInChinese()}æœˆ${lunar.getDayInChinese()}`;
        } catch (e) {
            console.log("å†œå†æ˜¾ç¤ºæ ¼å¼åŒ–é”™è¯¯:", e);
            return "å†œå†æ—¥æœŸ";
        }
    }

    // æ£€æŸ¥ä»Šå¤©æ˜¯å¦æœ‰ç”Ÿæ—¥
    function checkTodayBirthdays() {
        todayBirthdays = [];
        const today = new Date();
        const todayYear = today.getFullYear();
        const todayMonth = today.getMonth();
        const todayDate = today.getDate();
        
        birthdayData.forEach(person => {
            const bDay = new Date(person.birthday);
            let isBirthday = false;
            
            if (person.isLunar) {
                // å†œå†ç”Ÿæ—¥ï¼šæ¯”è¾ƒå†œå†æœˆæ—¥
                try {
                    // è·å–ä»Šå¤©æ—¥æœŸçš„å†œå†
                    const todaySolar = Solar.fromDate(today);
                    const todayLunar = todaySolar.getLunar();
                    
                    // è·å–ç”Ÿæ—¥å¯¹åº”çš„å†œå†
                    const birthSolar = Solar.fromDate(bDay);
                    const birthLunar = birthSolar.getLunar();
                    
                    // æ¯”è¾ƒå†œå†çš„æœˆå’Œæ—¥
                    if (todayLunar.getMonth() === birthLunar.getMonth() && 
                        todayLunar.getDay() === birthLunar.getDay()) {
                        isBirthday = true;
                    }
                } catch (e) {
                    console.log("å†œå†ç”Ÿæ—¥è®¡ç®—é”™è¯¯:", e);
                }
            } else {
                // å…¬å†ç”Ÿæ—¥ï¼šæ¯”è¾ƒå…¬å†æœˆæ—¥
                if (todayMonth === bDay.getMonth() && todayDate === bDay.getDate()) {
                    isBirthday = true;
                }
            }
            
            if (isBirthday) {
                todayBirthdays.push(person);
            }
        });
        
        return todayBirthdays.length > 0;
    }

    // åˆå§‹åŒ–ï¼šåŠ è½½ JSON æ•°æ®
    async function loadData() {
        try {
            const response = await fetch('birthdays.json');
            birthdayData = await response.json();
            renderAll();
            startAgeTimer();
        } catch (e) {
            console.error("æ— æ³•åŠ è½½ç”Ÿæ—¥æ•°æ®ï¼Œè¯·æ£€æŸ¥ JSON æ–‡ä»¶", e);
            document.getElementById('friendsList').innerHTML = '<div class="empty-state">æ— æ³•åŠ è½½æ•°æ®</div>';
        }
    }

    // æ¸²æŸ“å‡½æ•°
    function renderAll() {
        renderCalendar();
        renderFriendsList();
        renderDynamicPanel();
    }

    // æ ¸å¿ƒï¼šæ—¥å†é€»è¾‘
    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const display = document.getElementById('currentMonthDisplay');
        const banner = document.getElementById('celebrationBanner');
        grid.innerHTML = '';
        
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        display.innerText = `${year}å¹´ ${month + 1}æœˆ`;

        // æ˜ŸæœŸå¤´
        const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        days.forEach(d => {
            const el = document.createElement('div');
            el.className = 'day-name';
            el.innerText = d;
            grid.appendChild(el);
        });

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        // ç©ºç™½å ä½
        for(let i = 0; i < firstDay; i++) {
            grid.appendChild(document.createElement('div'));
        }

        // å¡«å……æ—¥æœŸ
        for(let d = 1; d <= lastDate; d++) {
            const cell = document.createElement('div');
            cell.className = 'day-cell';
            const thisDate = new Date(year, month, d);
            const today = new Date();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
            const isToday = thisDate.toDateString() === today.toDateString();
            if (isToday) {
                cell.classList.add('today');
            }

            // å†œå†è®¡ç®—
            let lunarText = '';
            let festivalText = '';
            let festivalsToShow = [];
            try {
                const solar = Solar.fromDate(thisDate);
                const lDate = solar.getLunar();
                lunarText = lDate.getDayInChinese(); // è¿™è¡Œéœ€è¦ä¿ç•™ï¼Œç”¨æ¥æ˜¾ç¤ºå†œå†æ—¥
                
                // æ£€æŸ¥å…¬å†èŠ‚æ—¥
                const monthDay = `${thisDate.getMonth() + 1}-${thisDate.getDate()}`;
                const solarFestival = solarFestivals[monthDay];
                if (solarFestival) {
                    festivalsToShow.push(solarFestival);
                }
                
                // æ£€æŸ¥å†œå†èŠ‚æ—¥ï¼ˆé˜²æ­¢ä¸å…¬å†èŠ‚æ—¥é‡å¤ï¼‰
                const lunarFestivals = lDate.getFestivals();
                if (lunarFestivals.length > 0) {
                    // åªæ·»åŠ ä¸é‡å¤çš„å†œå†èŠ‚æ—¥
                    lunarFestivals.forEach(fest => {
                        if (!festivalsToShow.includes(fest)) {
                            festivalsToShow.push(fest);
                        }
                    });
                }
                
                // å¦‚æœæ²¡æœ‰èŠ‚æ—¥ï¼Œæ£€æŸ¥èŠ‚æ°”
                const jieQi = lDate.getJieQi();
                if (jieQi && festivalsToShow.length === 0) {
                    festivalsToShow.push(jieQi);
                }
                
                // å¦‚æœæœ‰å¤šä¸ªèŠ‚æ—¥ï¼Œç”¨æ–œçº¿åˆ†éš”æ˜¾ç¤ºå‰2ä¸ªï¼ˆé¿å…å¤ªé•¿ï¼‰
                if (festivalsToShow.length > 0) {
                    festivalText = festivalsToShow.slice(0, 2).join(' / ');
                }
            } catch (e) {
                console.log("å†œå†è®¡ç®—é”™è¯¯:", e);
                lunarText = '';
            }

            // åŒ¹é…ç”Ÿæ—¥
            let birthdayHtml = '';
            birthdayData.forEach(person => {
                const bDay = new Date(person.birthday);
                let isBirthday = false;
                
                if (person.isLunar) {
                    // å†œå†ç”Ÿæ—¥ï¼šæ¯”è¾ƒå†œå†æœˆæ—¥
                    try {
                        // è·å–å½“å‰æ—¥æœŸçš„å†œå†
                        const currentSolar = Solar.fromDate(thisDate);
                        const currentLunar = currentSolar.getLunar();
                        
                        // è·å–ç”Ÿæ—¥å¯¹åº”çš„å†œå†
                        const birthSolar = Solar.fromDate(bDay);
                        const birthLunar = birthSolar.getLunar();
                        
                        // æ¯”è¾ƒå†œå†çš„æœˆå’Œæ—¥
                        if (currentLunar.getMonth() === birthLunar.getMonth() && 
                            currentLunar.getDay() === birthLunar.getDay()) {
                            isBirthday = true;
                        }
                    } catch (e) {
                        console.log("å†œå†ç”Ÿæ—¥è®¡ç®—é”™è¯¯:", e);
                    }
                } else {
                    // å…¬å†ç”Ÿæ—¥ï¼šæ¯”è¾ƒå…¬å†æœˆæ—¥
                    if (month === bDay.getMonth() && d === bDay.getDate()) {
                        isBirthday = true;
                    }
                }
                
                if (isBirthday) {
                    birthdayHtml += `<div class="birthday-tag"><i class="fas fa-cake-candles"></i> ${person.name}</div>`;
                    
                    // å¦‚æœæ˜¯ä»Šå¤©å¹¶ä¸”æœ‰ç”Ÿæ—¥ï¼Œæ·»åŠ åº†ç¥æ ·å¼
                    if (isToday) {
                        cell.classList.add('today-birthday');
                    }
                }
            });

            cell.innerHTML = `
                <div class="solar-num">${d}</div>
                <div class="lunar-info ${festivalText ? 'festival' : ''}">
                    ${festivalText || lunarText}
                </div>
                ${birthdayHtml}
            `;
            grid.appendChild(cell);
        }
        
        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦æœ‰ç”Ÿæ—¥ï¼Œæ˜¾ç¤º/éšè—åº†ç¥æ¨ªå¹…
        const hasTodayBirthday = checkTodayBirthdays();
        if (hasTodayBirthday) {
            banner.style.display = 'flex';
            const names = todayBirthdays.map(p => p.name).join('ã€');
            document.getElementById('bannerText').textContent = 
                todayBirthdays.length === 1 ? 
                `ä»Šå¤© ${names} è¿‡ç”Ÿæ—¥ï¼` : 
                `ä»Šå¤© ${names} ç­‰${todayBirthdays.length}äººè¿‡ç”Ÿæ—¥ï¼`;
        } else {
            banner.style.display = 'none';
        }
		
		if (hasTodayBirthday) {
            // å»¶è¿Ÿ1ç§’æ˜¾ç¤ºï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°é¡µé¢
            setTimeout(showCelebration, 1000);
        }
    }

    // å³ä¾§åˆ—è¡¨ï¼šæ˜¾ç¤ºæœ‹å‹ä¿¡æ¯å’Œå²æ•°
    function renderFriendsList() {
        const list = document.getElementById('friendsList');
        if (!birthdayData.length) {
            list.innerHTML = '<div class="empty-state">æš‚æ— æœ‹å‹æ•°æ®</div>';
            return;
        }
        
        list.innerHTML = birthdayData.map(person => {
            const bDate = new Date(person.birthday);
            const age = calculateAge(person.birthday, person.isLunar);
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©è¿‡ç”Ÿæ—¥
            const isTodayBirthday = todayBirthdays.some(p => p.name === person.name);
            
            return `
                <div class="user-item ${isTodayBirthday ? 'today-birthday-item' : ''}">
                    <img src="images/${person.avatar}" class="avatar" 
                         onerror="this.src='https://ui-avatars.com/api/?name=${person.name}&background=${person.isLunar ? '3498db' : 'e74c3c'}&color=fff&size=128'">
                    <div class="user-info">
                        <div class="user-name">${person.name} ${isTodayBirthday ? 'ğŸ‰' : ''}</div>
                        <div class="user-details">
                            <span class="calendar-type ${person.isLunar ? 'lunar' : ''}">
                                ${person.isLunar ? 'å†œå†' : 'å…¬å†'}
                            </span>
                            ${person.isLunar ? formatLunarDate(bDate) : `${bDate.getFullYear()}å¹´${bDate.getMonth() + 1}æœˆ${bDate.getDate()}æ—¥`}<br>
                            æ³•å®šå¹´é¾„: <span class="age-num" data-birth="${person.birthday}" data-lunar="${person.isLunar}">${age}</span> å²
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // æ›´æ–°æ‰€æœ‰å¹´é¾„æ˜¾ç¤º
    function updateAges() {
        document.querySelectorAll('.age-num').forEach(span => {
            const birth = span.dataset.birth;
            const isLunar = span.dataset.lunar === 'true';
            const age = calculateAge(birth, isLunar);
            span.textContent = age;
        });
    }
	
	// åˆ›å»ºå½©æ¡æ•ˆæœ
    function createConfetti() {
        const container = document.getElementById('fullscreenCelebration');
        const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#9b5de5', '#00bbf9'];
        
        // ç§»é™¤åŸæœ‰çš„å½©æ¡
        const existingConfetti = container.querySelectorAll('.confetti');
        existingConfetti.forEach(el => el.remove());
        
        // åˆ›å»ºæ–°çš„å½©æ¡åŠ¨ç”»
        for (let i = 0; i < 50; i++) { // å‡å°‘æ•°é‡ä»¥æé«˜æ€§èƒ½
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // éšæœºé¢œè‰²
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // éšæœºä½ç½® - ç¡®ä¿åœ¨æ•´ä¸ªå±å¹•ä¸Šåˆ†å¸ƒ
            confetti.style.left = Math.random() * 100 + 'vw';
            
            // éšæœºå¤§å°
            const size = Math.random() * 10 + 5;
            confetti.style.width = size + 'px';
            confetti.style.height = size * 2 + 'px';
            
            // éšæœºæ—‹è½¬è§’åº¦
            const rotation = Math.random() * 360;
            
            // åŠ¨ç”»è®¾ç½® - ç¡®ä¿å®Œæ•´çš„ä¸‹è½åŠ¨ç”»
            const duration = Math.random() * 2 + 2; // 2-4ç§’
            const delay = Math.random() * 2; // éšæœºå»¶è¿Ÿå¼€å§‹
            
            confetti.style.animation = `fall ${duration}s ease-in ${delay}s infinite`;
            
            // åˆ›å»ºä¸‹è½åŠ¨ç”»
            if (!document.querySelector('#confetti-animation')) {
                const style = document.createElement('style');
                style.id = 'confetti-animation';
                style.innerHTML = `
                    @keyframes fall {
                        0% {
                            top: -50px;
                            transform: rotate(${rotation}deg);
                            opacity: 1;
                        }
                        100% {
                            top: 100vh;
                            transform: rotate(${rotation + 360}deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            container.appendChild(confetti);
        }
    }
    
    // æ˜¾ç¤ºåº†ç¥åŠ¨ç”»
    function showCelebration() {
        const celebration = document.getElementById('fullscreenCelebration');
        const namesElement = document.getElementById('celebrationNames');
        
        if (todayBirthdays.length > 0) {
            // æ˜¾ç¤ºåº†ç¥åŠ¨ç”»
            celebration.style.display = 'flex';
            
            // æ›´æ–°åå­—æ˜¾ç¤º
            const names = todayBirthdays.map(p => p.name).join('ã€');
            namesElement.textContent = names;
            
            // åˆ›å»ºå½©æ¡
            createConfetti();
            
            // è®¾ç½®è‡ªåŠ¨å…³é—­å€’è®¡æ—¶
            let countdown = 10;
            const countdownElement = document.getElementById('countdown');
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = `${countdown}ç§’åè‡ªåŠ¨å…³é—­`;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    closeCelebration();
                }
            }, 1000);
            
            // ä¿å­˜å€’è®¡æ—¶å¼•ç”¨ä»¥ä¾¿æ¸…é™¤
            window.celebrationCountdown = countdownInterval;
        }
    }
    
    // å…³é—­åº†ç¥åŠ¨ç”»
    function closeCelebration() {
        const celebration = document.getElementById('fullscreenCelebration');
        celebration.style.display = 'none';
        
        // æ¸…é™¤å½©æ¡
        const confettiElements = document.querySelectorAll('.confetti');
        confettiElements.forEach(el => el.remove());
        
        // æ¸…é™¤å€’è®¡æ—¶
        if (window.celebrationCountdown) {
            clearInterval(window.celebrationCountdown);
        }
    }

    // æ¸²æŸ“åŠ¨æ€é¢æ¿ï¼šåº†ç¥é¢æ¿æˆ–æœªæ¥30å¤©é¢æ¿
    function renderDynamicPanel() {
        const container = document.getElementById('dynamicPanel');
        const hasTodayBirthday = checkTodayBirthdays();
        
        if (hasTodayBirthday && todayBirthdays.length > 0) {
            // æ˜¾ç¤ºåº†ç¥é¢æ¿
            container.className = 'upcoming-panel celebration-panel';
            container.innerHTML = `
                <h3 class="celebration-title"><i class="fas fa-birthday-cake"></i> ä»Šæ—¥å¯¿æ˜Ÿ </h3>
                <div class="celebration-cards" id="celebrationContent">
                    ${todayBirthdays.map(person => {
                        const bDate = new Date(person.birthday);
                        const age = Math.round(parseFloat(calculateAge(person.birthday, person.isLunar)));
                        const dateStr = person.isLunar ? 
                            formatLunarDisplay(bDate) : 
                            `${bDate.getMonth() + 1}æœˆ${bDate.getDate()}æ—¥`;
                        
                        return `
                            <div class="celebration-card">
                                <img src="images/${person.avatar}" class="celebration-avatar" 
                                     onerror="this.src='https://ui-avatars.com/api/?name=${person.name}&background=${person.isLunar ? '3498db' : 'e74c3c'}&color=fff&size=256'">
                                <div class="celebration-name">${person.name}</div>
                                <div class="celebration-age">${age} å²</div>
                                <div class="celebration-date">
                                    <span class="calendar-type ${person.isLunar ? 'lunar' : ''}">
                                        ${person.isLunar ? 'å†œå†' : 'å…¬å†'}
                                    </span>
                                    ${dateStr}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        } else {
            // æ˜¾ç¤ºæœªæ¥30å¤©ç”Ÿæ—¥é¢æ¿
            container.className = 'upcoming-panel';
            container.innerHTML = `
                <h3><i class="fas fa-gift"></i> æœªæ¥30å¤©ç”Ÿæ—¥</h3>
                <div id="upcomingContent" class="upcoming-cards">
                    ${renderUpcomingContent()}
                </div>
            `;
        }
    }

    // ç”Ÿæˆæœªæ¥30å¤©ç”Ÿæ—¥å†…å®¹
    function renderUpcomingContent() {
        const upcoming = [];
        const now = new Date();
        const thirtyDaysLater = new Date(now);
        thirtyDaysLater.setDate(thirtyDaysLater.getDate() + 30);

        birthdayData.forEach(person => {
            let nextBirthday;
            const bDate = new Date(person.birthday);
            
            if (person.isLunar) {
                // å†œå†ç”Ÿæ—¥ï¼šæ‰¾åˆ°ä»Šå¹´å¯¹åº”çš„å…¬å†æ—¥æœŸ
                try {
                    const currentYear = now.getFullYear();
                    const thisYearBirth = getLunarBirthdaySolarDate(bDate, currentYear);
                    nextBirthday = new Date(thisYearBirth);
                    
                    // å¦‚æœä»Šå¹´ç”Ÿæ—¥å·²ç»è¿‡äº†ï¼Œçœ‹æ˜å¹´
                    if (nextBirthday < now) {
                        const nextYearBirth = getLunarBirthdaySolarDate(bDate, currentYear + 1);
                        nextBirthday = new Date(nextYearBirth);
                    }
                } catch (e) {
                    console.log("å†œå†ç”Ÿæ—¥é¢„å‘Šè®¡ç®—é”™è¯¯:", e);
                    return;
                }
            } else {
                // å…¬å†ç”Ÿæ—¥ï¼šä»Šå¹´ç”Ÿæ—¥
                const currentYear = now.getFullYear();
                nextBirthday = new Date(currentYear, bDate.getMonth(), bDate.getDate());
                
                // å¦‚æœä»Šå¹´ç”Ÿæ—¥å·²ç»è¿‡äº†ï¼Œçœ‹æ˜å¹´
                if (nextBirthday < now) {
                    nextBirthday.setFullYear(currentYear + 1);
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦åœ¨æœªæ¥30å¤©å†…
            if (nextBirthday >= now && nextBirthday <= thirtyDaysLater) {
                const diffDays = Math.ceil((nextBirthday - now) / (1000 * 60 * 60 * 24));
                upcoming.push({
                    name: person.name,
                    days: diffDays,
                    dateDisplay: person.isLunar ? formatLunarDisplay(nextBirthday) : nextBirthday.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' }),
                    isLunar: person.isLunar
                });
            }
        });

        // æŒ‰å¤©æ•°æ’åº
        upcoming.sort((a, b) => a.days - b.days);
        
        if (upcoming.length > 0) {
            return upcoming.map(u => `
                <div class="upcoming-card">
                    <div class="upcoming-name">${u.name}</div>
                    <div class="upcoming-days">${u.days} å¤©</div>
                    <div class="upcoming-date">
                        <span class="calendar-type ${u.isLunar ? 'lunar' : ''}">
                            ${u.isLunar ? 'å†œå†' : 'å…¬å†'}
                        </span>
                        ${u.dateDisplay}
                    </div>
                </div>
            `).join('');
        } else {
            return `
                <div class="empty-state">
                    <i class="fas fa-gift"></i>
                    <h4>è¿‘æœŸæ— ç”Ÿæ—¥</h4>
                    <p>æœªæ¥30å¤©å†…æ²¡æœ‰æœ‹å‹è¿‡ç”Ÿæ—¥</p>
                </div>
            `;
        }
    }

    // è¾…åŠ©åŠŸèƒ½
    function prevMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    }
	
	function goToToday() {
        currentDate = new Date();
        renderAll();
    }
    
    function nextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    }
    
    function toggleTheme() {
        const body = document.documentElement;
        const icon = document.querySelector('.theme-toggle i');
        if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
            icon.className = 'fas fa-moon';
            icon.style.color = '';
            localStorage.setItem('theme', 'light');
        } else {
            body.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            icon.style.color = '#fbbf24';
            localStorage.setItem('theme', 'dark');
        }
    }

    function startAgeTimer() {
        updateAges();
        // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å¹´é¾„
        setInterval(updateAges, 60000);
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    loadData();
	
	// æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' || event.key === ' ') {
            closeCelebration();
        }
    });
	
	// åœ¨é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®æ­£ç¡®çš„ä¸»é¢˜å›¾æ ‡
	window.addEventListener('DOMContentLoaded', function() {
        const icon = document.querySelector('.theme-toggle i');
        const theme = localStorage.getItem('theme') || 
                      (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        
        if (theme === 'dark') {
            icon.className = 'fas fa-sun';
            icon.style.color = '#fbbf24';
        } else {
            icon.className = 'fas fa-moon';
            icon.style.color = '';
        }
    });
</script>
<script>
    // PWA Service Worker æ³¨å†Œ
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(registration => {
                    console.log('PWA ServiceWorker æ³¨å†ŒæˆåŠŸ: ', registration.scope);
                })
                .catch(err => {
                    console.log('PWA ServiceWorker æ³¨å†Œå¤±è´¥: ', err);
                });
        });
    }
</script>
</body>
</html>